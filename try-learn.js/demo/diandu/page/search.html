<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no">
    <title>Demo</title>
    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" sizes="192x192" href="assets/i/app-icon72x72@2x.png">
    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Demo" />
    <link rel="stylesheet" href="http://cdn.amazeui.org/amazeui/2.6.0/css/amazeui.css">
    <link rel="stylesheet" href="../css/hsky.css">
    <style>
    body {
        background-color: #e6f7ff;
    }
    
    a {
        cursor: pointer;
    }
    
    .currentbg {
        background-color: pink;
    }
    
    .am-control-nav {
        display: none;
    }
    
    .nav a,
    .nav span {
        font-size: 1.8rem;
    }
    
    p {
        display: block;
        -webkit-margin-before: 0.2em;
        -webkit-margin-after: 0.2em;
        -webkit-margin-start: 0px;
        -webkit-margin-end: 0px;
    }
    
    .am-offcanvas-bar {
        background-color: #FFFFFF;
        color: #999999;
    }
    
    .am-offcanvas-content a {
        color: #999999;
    }
    
    .hsky {
        border: 1px solid #0E6EBC;
        height: auto;
        width: 96%;
        padding: 0rem 0rem;
        margin: 1rem 2% 0 2%;
        background-color: #FFFFFF;
    }
    
    .hsky p {
        padding: 0.5rem 1rem;
    }
    
    .hsky #count {
        display: block;
        float: right;
        margin-top: 1rem;
    }
    
    input {
        outline: none;
    }
    </style>
</head>

<body>
    <!-- 弹出框 -->
    <div class="am-modal am-modal-alert" tabindex="-1" id="my-alert">
        <div class="am-modal-dialog">
            <div class="am-modal-hd">对不起，此功能暂未开放！</div>
            <div class="am-modal-bd">
            </div>
            <div class="am-modal-footer">
                <span class="am-modal-btn">确定</span>
            </div>
        </div>
    </div>
    <!-- 主体内容 -->
    <div class="page" style="background-color:#e6f7ff;">
        <!--导航条-->
        <header class="nav" data-am-sticky>
            <span class='nav-text-left'> 
               <a href="hsky.html"><span class='am-icon-chevron-left'></span></a>
            </span>
            <span class='nav-text-center'>搜 索</span>
            <!-- <span class='nav-text-right am-icon-search'></span> -->
            <div style='clear:both;'></div>
        </header>
        <div style="height:3rem;width:90%;margin:2rem auto;">
            <div style='width:90%;;height:3rem;float:left;'>
                <input type="text" style='width:98%;height:100%;border-radius:3rem;border:1px solid #999999;font-size:2rem;padding:0 2rem;' id='searchText'>
            </div>
            <div style='width:10%;height:3rem;float:right;line-height:3rem;text-align: left;cursor:pointer;'>
                <span class='am-icon-search am-icon-lg am-text-primary' id='searchBtn'></span>
            </div>
        </div>
        <hr>
        <!--内容区-->
        <div class="content" style='background-color:#e6f7ff'>
            <p style='text-align: center;font-size:1.5rem;' class='am-text-primary'>输入关键字搜索你要的信息......</p>
        </div>
        <!--页脚-->
        <p></p>
    </div>
    <!-- 音频标签 -->
    <audio id="audio"></audio>
    <script src="http://lib.sinaapp.com/js/jquery/1.9.1/jquery-1.9.1.min.js"></script>
    <script src="http://cdn.amazeui.org/amazeui/2.6.0/js/amazeui.js"></script>
    <script src="http://cdn.amazeui.org/amazeui/2.6.0/js/amazeui.ie8polyfill.js"></script>
    <script src="http://cdn.amazeui.org/amazeui/2.6.0/js/amazeui.widgets.helper.js"></script>
    <script>
    var hsky = [{
        hanyu: "1. 学习",
        hasakeyu: "ۇيرەنۋ",
        fayin: "吾依热努",
        start: "00:03.933",
        end: "00:07.140",
        mp3: "../mp3/hsky001.m4a",
        count: 1230

    }, {
        hanyu: "2. 天气",
        hasakeyu: "اۋا رايى",
        fayin: "阿瓦莱额",
        start: "00:07.140",
        end: "00:10.228",
        mp3: "../mp3/hsky001.m4a",
        count: 365
    }, {
        hanyu: "3. 出生",
        hasakeyu: "تۋىلۋ",
        fayin: "图俄鲁",
        start: "00:10.228",
        end: "00:13.165",
        mp3: "../mp3/hsky001.m4a",
        count: 160
    }, {
        hanyu: "4. 六",
        hasakeyu: "التى",
        fayin: "阿勒特",
        start: "00:13.165",
        end: "00:15.525",
        mp3: "../mp3/hsky001.m4a",
        count: 234
    }, {
        hanyu: "5. 高兴",
        hasakeyu: "قۋانۋ ",
        fayin: "胡安吾",
        start: "00:15.525",
        end: "00:18.213",
        mp3: "../mp3/hsky001.m4a",
        count: 321
    }, {
        hanyu: "6. 书",
        hasakeyu: "كىتاپ",
        fayin: "克塔普",
        start: "00:18.213",
        end: "00:20.782",
        mp3: "../mp3/hsky001.m4a",
        count: 632
    }, {
        hanyu: "7. 电话",
        hasakeyu: "تەلەفون",
        fayin: "特烈弗恩",
        start: "00:20.782",
        end: "00:22.725",
        mp3: "../mp3/hsky001.m4a",
        count: 99
    }, {
        hanyu: "8. 同学",
        hasakeyu: "ساباقتاس",
        fayin: "萨巴赫塔斯",
        start: "00:22.725",
        end: "00:25.670",
        mp3: "../mp3/hsky001.m4a",
        count: 660
    }, {
        hanyu: "9. 谢谢",
        hasakeyu: "راقىمەت",
        fayin: "热合麦特",
        start: "00:25.670",
        end: "00:28.607",
        mp3: "../mp3/hsky001.m4a",
        count: 423
    }, {
        hanyu: "10.东西",
        hasakeyu: "نارسە",
        fayin: "纳尔斯也",
        start: "00:28.607",
        end: "00:32:00",
        mp3: "../mp3/hsky001.m4a",
        count: 963
    }, {
        hanyu: "1. 你现在学习什么？",
        hasakeyu: "قازىر نە ۇيرەنىپ جاتىرسىڭ؟",
        fayin: "哈子尔／聂／吾依热努普／加特尔森？",
        start: "00:02.504",
        end: "00:07.421",
        mp3: "../mp3/hsky002.m4a",
        count: 12356
    }, {
        hanyu: "2. 今天天气很好。",
        hasakeyu: "بۇگىن اۋا رايى وتە جاقسى.",
        fayin: "布衮／阿瓦莱额／窝铁／贾克斯。",
        start: "00:07.421",
        end: "00:12.680",
        mp3: "../mp3/hsky002.m4a",
        count: 23650
    }, {
        hanyu: "3. 我出生在新疆。",
        hasakeyu: "مەن شينجياڭدا تۋىلعانمىن.",
        fayin: "芈恩／新疆达／图勒汗门。",
        start: "00:12.680",
        end: "00:22.954",
        mp3: "../mp3/hsky002.m4a",
        count: 14526
    }, {
        hanyu: "4. 我家有六口人。",
        hasakeyu: "ۇيىمىزدە التى جان بار.",
        fayin: "吾尤米孜碟／阿勒特／占／巴尔。",
        start: "00:01.168",
        end: "00:07.849",
        mp3: "../mp3/hsky003.m4a",
        count: 22365
    }, {
        hanyu: "5. 很高兴认识您。",
        hasakeyu: "سىزبەن تانىسقانىما قۋانىشتىمىن.",
        fayin: "思孜本／塔尼斯哈努玛／胡安仕特门。",
        start: "00:07.849",
        end: "00:13.640",
        mp3: "../mp3/hsky003.m4a",
        count: 46352

    }, {
        hanyu: "6. 我在看书。",
        hasakeyu: "مەن كىتاپ وقىپ وتىرمىن.",
        fayin: "芈恩／克塔普／窝合普／窝图尔门。",
        start: "00:13.640",
        end: "00.19.669",
        mp3: "../mp3/hsky003.m4a",
        count: 12360
    }]

    $(document).ready(function() {
        $("#searchBtn").click(function() {
            var searchText = $("#searchText").val();
            if (searchText === "") {
                return;
            }
            var list = [];
            var rege = new RegExp("" + searchText + "", "g");
            console.log(rege)
            for (var i = 0; len = hsky.length, i < len; i++) {
                if (hsky[i].hanyu.match(rege)) {
                    list.push(hsky[i]);
                }
            }
            console.log(list)
            if (list.length >= 1) {
                drawPage(list, "和【<label style='color:red;'><b>" + searchText + "</b></label>】相关的单词和句子");
            } else {
                drawPage(list, "暂无搜索结果");
            }

        });
    });

    function drawPage(arr, msg) {
        console.log(arr)
        var html = "<p style='text-align: center;font-size:1.5rem;' class='am-text-primary'>" + msg + "</p>";
        $(arr).each(function(index, data) {
            console.log(data)
            html = html.concat("<div class='hsky' mp3='" + data.mp3 + "' stime='" + data.start + "' etime='" + data.end + "'>");

            html = html.concat("<div style='position:relative;'><div style='width:6rem;height:4rem;float:right;font-size:2rem;text-align:center;line-height:4rem;color:#0E6EBC'>" + (index + 1) + "/" + arr.length + "</div></div>");

            html = html.concat("<p style='font-size:1.5rem;margin-top:1rem;'><label style='font-size:1.5rem;color:#0E6EBC;'>【中　　文】</label>" + data.hanyu + "</p>");
            html = html.concat("<p style='font-size:1.5rem'><label style='font-size:1.5rem;color:#0E6EBC;'>【哈萨克语】</label>" + data.hasakeyu + "</p>");
            html = html.concat("<p style='font-size:1.5rem'><label style='font-size:1.5rem;color:#0E6EBC;'>【中文音译】</label>" + data.fayin + "</p>");

            html = html.concat("<p><a class='am-icon-btn am-success am-icon-play'  onclick=\"play('" + data.mp3 + "','" + data.start + "','" + data.end + "',this)\" style='width:3rem;height:3rem;line-height:3rem;font-size:1.5rem;'></a>&nbsp;&nbsp;&nbsp;&nbsp;");
            html = html.concat("<a class='am-icon-btn am-secondary am-icon-repeat' onclick=\"singleLoop('" + data.mp3 + "','" + data.start + "','" + data.end + "',this)\" style='width:3rem;height:3rem;line-height:3rem;font-size:1.5rem;'></a>&nbsp;&nbsp;&nbsp;&nbsp;");
            html = html.concat("<a class='am-icon-btn am-warning am-icon-stop' onclick='pause()' style='width:3rem;height:3rem;line-height:3rem;font-size:1.5rem;'></a>&nbsp;&nbsp;&nbsp;&nbsp;");
            html = html.concat("<a class='am-icon-btn am-danger am-icon-microphone' style='width:3rem;height:3rem;line-height:3rem;font-size:1.5rem;' data-am-modal=\"{target: '#my-alert'}\"></a>&nbsp;&nbsp;&nbsp;&nbsp;");
            var count = data.count;
           html = html.concat("<span id='count' style='font-size:1.2rem;line-height:0.3rem;'>已有<label style='color:orange'>" + count + "</label>人学习 <img  src='../images/icon.png'/ style='max-width:2rem;vertical-align:bottom;'/></span></p>");
            html = html.concat("<div style=\"width:100%;height:3rem;background-image:url('../images/bottom.jpg');background-size:100% 100%\"></div>");
            html = html.concat("</div>");

        });
        html = html.concat("<p>&nbsp;&nbsp;&nbsp;</p>");
        $(".content").html(html);
    }


    // drawPage(hsky);
    var audio = $("#audio")[0];
    var timer = null;
    var loopTimer = null;

    /**
     * [singleLoop description]
     * @param  {[type]} src   [description]
     * @param  {[type]} stime [description]
     * @param  {[type]} etime [description]
     * @param  {[type]} dom   [description]
     * @return {[type]}       [description]
     */
    function singleLoop(src, stime, etime, dom) {
        if (loopTimer !== null) {
            clearInterval(loopTimer);
            loopTimer = null;
            audio.pause();
            $(".hsky").removeClass("currentbg");
            audio.src = "";
        }

        pause();
        audio.src = src;
        audio.currentTime = parseFloat(time2time(stime));
        audio.play();

        // console.log($(dom).parent().parent().addClass("currentbg"));
        if (timer === null) {
            timer = setInterval(function() {
                console.log(audio.currentTime + "                      " + time2time(etime));
                if (audio.currentTime >= time2time(etime)) {
                    audio.currentTime = parseFloat(time2time(stime));
                }
            }, 100)
        }
    }

    // 用k为单位表示播放量
    function formatK(count) {
        var _count = 0;
        if (count < 1024) {
            _count = count;
        }
        if (count >= 1024) {
            _count = (count / 1024).toFixed(2) + "<span style='color:orange;'> k</span>";
        }
        return _count;
    }

    function play(src, stime, etime, dom) {
        if (loopTimer !== null) {
            clearInterval(loopTimer);
            loopTimer = null;
            audio.pause();
            $(".hsky").removeClass("currentbg");
            audio.src = "";
        }
        pause();
        audio.src = src;
        audio.currentTime = parseFloat(time2time(stime));
        audio.play();

        // console.log($(dom).parent().parent().addClass("currentbg"));
        if (timer === null) {
            timer = setInterval(function() {


                console.log(audio.currentTime);
                if (audio.currentTime >= time2time(etime)) {
                    clearInterval(timer);
                    timer = null;
                    audio.pause();
                    $(dom).parent().parent().removeClass("currentbg")
                }
            }, 100)
        }
    }


    function pause() {
        var audio = $("#audio")[0];
        audio.pause();
        clearInterval(loopTimer);
        loopTimer = null;
        clearInterval(timer);
        timer = null;
    }

    function time2time(time) {
        var str = time;
        var arr = str.split(':');
        var seconds = parseInt(arr[0] * 60) + parseFloat(arr[1]);
        return seconds;
    }
    </script>
</body>

</html>
