<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no">
    <title>Demo</title>
    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" sizes="192x192" href="assets/i/app-icon72x72@2x.png">
    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Demo" />
    <link rel="stylesheet" href="http://cdn.amazeui.org/amazeui/2.6.0/css/amazeui.css">
    <link rel="stylesheet" href="../css/style.css">
    <style>
    a {
        cursor: pointer;
    }
    
    .currentbg {
        background-color: pink;
    }
    </style>
</head>

<body>
    <div class="page">
        <!--导航条-->
        <header class="nav">
            <span class='nav-text-left'> 
               <a href="#"></a>
            </span>
            <span class='nav-text-center'>哈萨克语学习</span>
            <span class='nav-text-right'><a href="#"></a></span>
            <div style='clear:both;'></div>
        </header>
        <!--内容区-->
        <div class="content">
        </div>
        <!--页脚-->
        <div class="footer">
            <span class="prev am-icon-chevron-left-" style="width:10%"></span>
            <span class="start am-icon-play" style="width:40%"></span>
            <span class="stop am-icon-stop" style="width:40%"></span>
            <span class="next am-icon-chevron-right-" style="width:10%"></span>
        </div>
    </div>
    <audio id="audio"></audio>
    <script src="http://lib.sinaapp.com/js/jquery/1.9.1/jquery-1.9.1.min.js"></script>
    <script src="http://cdn.amazeui.org/amazeui/2.6.0/js/amazeui.js"></script>
    <script src="http://cdn.amazeui.org/amazeui/2.6.0/js/amazeui.ie8polyfill.js"></script>
    <script src="http://cdn.amazeui.org/amazeui/2.6.0/js/amazeui.widgets.helper.js"></script>
    <script>
    var hsky = [{
        hanyu: "1. 学习",
        hasakeyu: "ۇيرەنۋ",
        fayin: "吾依热努",
        start: "00:03.933",
        end: "00:07.140",
        mp3: "../mp3/hsky001.m4a"

    }, {
        hanyu: "2. 天气",
        hasakeyu: "اۋا رايى",
        fayin: "阿瓦莱额",
        start: "00:07.140",
        end: "00:10.228",
        mp3: "../mp3/hsky001.m4a"

    }, {
        hanyu: "3. 出生",
        hasakeyu: "تۋىلۋ",
        fayin: "图俄鲁",
        start: "00:10.228",
        end: "00:13.165",
        mp3: "../mp3/hsky001.m4a"

    }, {
        hanyu: "4. 六",
        hasakeyu: "التى",
        fayin: "阿勒特",
        start: "00:13.165",
        end: "00:15.525",
        mp3: "../mp3/hsky001.m4a"

    }, {
        hanyu: "5. 高兴",
        hasakeyu: "قۋانۋ ",
        fayin: "胡安吾",
        start: "00:15.525",
        end: "00:18.213",
        mp3: "../mp3/hsky001.m4a"

    }, {
        hanyu: "6. 书",
        hasakeyu: "كىتاپ",
        fayin: "克塔普",
        start: "00:18.213",
        end: "00:20.782",
        mp3: "../mp3/hsky001.m4a"

    }, {
        hanyu: "7. 电话",
        hasakeyu: "تەلەفون",
        fayin: "特烈弗恩",
        start: "00:20.782",
        end: "00:22.725",
        mp3: "../mp3/hsky001.m4a"

    }, {
        hanyu: "8. 同学",
        hasakeyu: "ساباقتاس",
        fayin: "萨巴赫塔斯",
        start: "00:22.725",
        end: "00:25.670",
        mp3: "../mp3/hsky001.m4a"

    }, {
        hanyu: "9. 谢谢",
        hasakeyu: "راقىمەت",
        fayin: "热合麦特",
        start: "00:25.670",
        end: "00:28.607",
        mp3: "../mp3/hsky001.m4a"

    }, {
        hanyu: "10.东西",
        hasakeyu: "نارسە",
        fayin: "纳尔斯也",
        start: "00:28.607",
        end: "00:32:00",
        mp3: "../mp3/hsky001.m4a"

    }, {
        hanyu: "1. 你现在学习什么？",
        hasakeyu: "قازىر نە ۇيرەنىپ جاتىرسىڭ؟",
        fayin: "哈子尔／聂／吾依热努普／加特尔森？",
        start: "00:02.504",
        end: "00:07.421",
        mp3: "../mp3/hsky002.m4a"

    }, {
        hanyu: "2. 今天天气很好。",
        hasakeyu: "بۇگىن اۋا رايى وتە جاقسى.",
        fayin: "布衮／阿瓦莱额／窝铁／贾克斯。",
        start: "00:07.421",
        end: "00:12.680",
        mp3: "../mp3/hsky002.m4a"
    }, {
        hanyu: "3. 我出生在新疆。",
        hasakeyu: "مەن شينجياڭدا تۋىلعانمىن.",
        fayin: "芈恩／新疆达／图勒汗门。",
        start: "00:12.680",
        end: "00:22.954",
        mp3: "../mp3/hsky002.m4a"
    }, {
        hanyu: "4. 我家有六口人。",
        hasakeyu: "ۇيىمىزدە التى جان بار.",
        fayin: "吾尤米孜碟／阿勒特／占／巴尔。",
        start: "00:01.168",
        end: "00:07.849",
        mp3: "../mp3/hsky003.m4a"
    }, {
        hanyu: "5. 很高兴认识您。",
        hasakeyu: "سىزبەن تانىسقانىما قۋانىشتىمىن.",
        fayin: "思孜本／塔尼斯哈努玛／胡安仕特门。",
        start: "00:07.849",
        end: "00:13.640",
        mp3: "../mp3/hsky003.m4a"

    }, {
        hanyu: "6. 我在看书。",
        hasakeyu: "مەن كىتاپ وقىپ وتىرمىن.",
        fayin: "芈恩／克塔普／窝合普／窝图尔门。",
        start: "00:13.640",
        end: "00.19.669",
        mp3: "../mp3/hsky003.m4a"
    }]

    function drawPage(arr) {
        var html = "";
        $(arr).each(function(index, data) {
            html = html.concat("<div class='hsky' mp3='" + data.mp3 + "' stime='" + data.start + "' etime='" + data.end + "' style='border:1px solid #999999;height:auto;width:96%;padding:0.5rem 1rem;margin:1rem 2% 0 2%;'>");
            html = html.concat("<p style='font-size:2rem'>【<label style='font-size:1.5rem;color:orange;'>中　　文</label>】             " + data.hanyu + "</p>");
            html = html.concat("<p style='font-size:2rem'>【<label style='font-size:1.5rem;color:orange;'>哈萨克语</label>】    " + data.hasakeyu + "</p>");
            html = html.concat("<p style='font-size:2rem'>【<label style='font-size:1.5rem;color:orange;'>中文音译</label>】           " + data.fayin + "</p>");
            console.log(index + "     " + arr.length)

            html = html.concat("<p><a class='am-icon-btn am-success am-icon-play'  onclick=\"play('" + data.mp3 + "','" + data.start + "','" + data.end + "',this)\"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");

            html = html.concat("<a class='am-icon-btn am-secondary am-icon-stop' onclick='pause()'></a></p>");
            html = html.concat("</div>");
        });
        $(".content").html(html);
    }


    drawPage(hsky);
    var audio = $("#audio")[0];
    var timer = null;
    function play(src, stime, etime, dom) {

        audio.src = src;
        audio.currentTime = time2time(stime);
        audio.play();

        // console.log($(dom).parent().parent().addClass("currentbg"));
        if (timer === null) {
            timer = setInterval(function() {
                 console.log(audio.currentTime+"                      "+ time2time(etime));
                if (audio.currentTime >= time2time(etime)) {
                    clearInterval(timer);
                    timer = null;
                    audio.pause();
                    $(dom).parent().parent().removeClass("currentbg")
                }
            }, 100)
        }
    }

    var mp3Arr = ["../mp3/hsky001.m4a", "../mp3/hsky002.m4a", "../mp3/hsky003.m4a"];
    var number = 0;

    function player() {
        audio.src = mp3Arr[number];
        audio.play();
        findDivByAttr(mp3Arr[number], audio.currentTime);
        if (timer === null) {
            timer = setInterval(function() {
                    findDivByAttr(mp3Arr[number], audio.currentTime);
                    if (audio.ended === true) {
                        number++;
                        if (mp3Arr[number] == undefined) {
                            clearInterval(timer);
                            timer = null;
                            number = 0;
                        } else {
                            audio.src = mp3Arr[number];
                            audio.load();
                            audio.play();
                        }
                    }
                },
                100
            )
        }
    }


    function findDivByAttr(mp3, currentTime) {

        $("[mp3='" + mp3 + "']").each(function(index, data) {

            var t1 = time2time($(data).attr("stime"));
            var t2 = time2time($(data).attr("etime"));
            console.log(t1 + "         " + t2 + "           " + currentTime+"         "+data)
            if (t1 <= currentTime && currentTime <= t2) {
                $(data).addClass("currentbg");
            } else {
                $(data).removeClass("currentbg");
            }
            if(t2===NaN){
               $(data).removeClass("currentbg");
            }

        });


    }



    $(".start").click(function() {
        player();
    });



    $(".stop").click(function() {
        audio.pause();
        $(data).removeClass("currentbg");
    });


    function pause() {
        var audio = $("#audio")[0];
        audio.pause();
    }


    function time2time(time) {
        var str = time;
        var arr = str.split(':');
        var seconds = parseInt(arr[0] * 60) + parseFloat(arr[1]);
        return seconds;
    }
    </script>
</body>

</html>
