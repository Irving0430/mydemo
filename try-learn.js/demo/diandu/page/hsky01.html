<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no">
    <title>Demo</title>
    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" sizes="192x192" href="assets/i/app-icon72x72@2x.png">
    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Demo" />
    <link rel="stylesheet" href="http://cdn.amazeui.org/amazeui/2.6.0/css/amazeui.css">
    <link rel="stylesheet" href="../css/hsky.css">
    <style>
    a {
        cursor: pointer;
    }
    
    .currentbg {
        background-color: pink;
    }
    
    .am-control-nav {
        display: none;
    }
    
    .nav a,
    .nav span {
        font-size: 1.8rem;
    }
    
    p {
        display: block;
        -webkit-margin-before: 0.2em;
        -webkit-margin-after: 0.2em;
        -webkit-margin-start: 0px;
        -webkit-margin-end: 0px;
    }
    
    .am-offcanvas-bar {
        background-color: #FFFFFF;
        color: #999999;
    }
    
    .am-offcanvas-content a {
        color: #999999;
    }
    
    .hsky {
        border: 1px solid #0E6EBC;
        height: auto;
        width: 96%;
        padding: 0rem 0rem;
        margin: 1rem 2% 0 2%;
        background-color: #FFFFFF;
    }
    
    .hsky p {
        padding: 0.5rem 1rem;
    }
    
    .hsky #count {
        display: block;
        float: right;
        margin-top: 0rem;
    }
    </style>
</head>

<body>
    <!-- 目录 -->
    <div id="doc-oc-demo1" class="am-offcanvas">
        <div class="am-offcanvas-bar">
            <div class="am-offcanvas-content">
                <!--             <p>
                <input type='input'></input>     <span class="am-icon-search"></span>
            </p> -->
                <div data-am-widget="list_news" class="am-list-news am-list-news-default">
                    <!--列表标题-->
                    <div class="am-list-news-hd am-cf">
                        <!--带更多链接-->
                        <!--         <a href="##" class="">
                            <h2>A</h2>
                            <span class="am-list-news-more am-fr">更多 &raquo;</span>
                        </a> -->
                    </div>
                    <div class="am-list-news-bd">
                        <ul class="am-list">
                            <li class="am-g am-list-item-dated">
                                <a href="hsky.html" class="am-list-item-hd">常用词语</a>
                            </li>
                            <li class="am-g am-list-item-dated">
                                <a href="hsky01.html" class="am-list-item-hd">常用短语</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- 弹出框 -->
    <div class="am-modal am-modal-alert" tabindex="-1" id="my-alert">
        <div class="am-modal-dialog">
            <div class="am-modal-hd">对不起，此功能暂未开放！</div>
            <div class="am-modal-bd">
            </div>
            <div class="am-modal-footer">
                <span class="am-modal-btn">确定</span>
            </div>
        </div>
    </div>
    <div class="page" style="background-color:#e6f7ff;">
        <!--导航条-->
        <header class="nav" data-am-sticky>
            <span class='nav-text-left'> 
               <a href="index.html">首页</a>
            </span>
            <span class='nav-text-center'>常用短语</span>
            <a href="search.html"><span class='nav-text-right am-icon-search'></span></a>
            <div style='clear:both;'></div>
        </header>
        <!-- 滚动图片 -->
        <div class="am-slider am-slider-default" data-am-flexslider id="demo-slider-0">
            <ul class="am-slides">
                <li><img src="../images/banner1.jpg" /></li>
                <li><img src="../images/banner2.jpg" /></li>
                <li><img src="../images/banner3.jpg" /></li>
                <li><img src="../images/banner4.jpg" /></li>
            </ul>
        </div>
        <!--内容区-->
        <div class="content" style='background-color:#e6f7ff'>
        </div>
        <!--页脚-->
        <div class="footer" style='cursor:pointer;'>
            <span class="am-icon-list" style="width:33.33%" data-am-offcanvas="{target: '#doc-oc-demo1', effect: 'push'}"><label style='font-size:2rem;cursor:pointer;'>&nbsp;目录</label></span>
            <span style="width:33.33%">
                <div style='width:6rem;height:6rem;background-color:#0E6EBC;border-radius:3rem;margin:-2rem auto;text-align:center;line-height:6rem;border:0.2rem solid #1E90FF'>
                    <i class="start am-icon-play" style="margin:0 auto;display:block;"></i>
                </div>
            </span>
            <a href="wenhua.html"><span class="am-icon-book" style="width:33.33%;"><label style='font-size:2rem;cursor:pointer;' >&nbsp;文化习俗</label>
            </span></a>
        </div>
    </div>
    <!-- 音频标签 -->
    <audio id="audio"></audio>
    <script src="http://lib.sinaapp.com/js/jquery/1.9.1/jquery-1.9.1.min.js"></script>
    <script src="http://cdn.amazeui.org/amazeui/2.6.0/js/amazeui.js"></script>
    <script src="http://cdn.amazeui.org/amazeui/2.6.0/js/amazeui.ie8polyfill.js"></script>
    <script src="http://cdn.amazeui.org/amazeui/2.6.0/js/amazeui.widgets.helper.js"></script>
    <script>
    var hsky = [{
        hanyu: "1. 你现在学习什么？",
        hasakeyu: "قازىر نە ۇيرەنىپ جاتىرسىڭ؟",
        fayin: "哈子尔／聂／吾依热努普／加特尔森？",
        start: "00:02.504",
        end: "00:07.421",
        mp3: "../mp3/hsky002.m4a",
        count: 1235
    }, {
        hanyu: "2. 今天天气很好。",
        hasakeyu: "بۇگىن اۋا رايى وتە جاقسى.",
        fayin: "布衮／阿瓦莱额／窝铁／贾克斯。",
        start: "00:07.421",
        end: "00:12.680",
        mp3: "../mp3/hsky002.m4a",
        count: 2365
    }, {
        hanyu: "3. 我出生在新疆。",
        hasakeyu: "مەن شينجياڭدا تۋىلعانمىن.",
        fayin: "芈恩／新疆达／图勒汗门。",
        start: "00:12.680",
        end: "00:22.954",
        mp3: "../mp3/hsky002.m4a",
        count: 14526
    }, {
        hanyu: "4. 我家有六口人。",
        hasakeyu: "ۇيىمىزدە التى جان بار.",
        fayin: "吾尤米孜碟／阿勒特／占／巴尔。",
        start: "00:01.168",
        end: "00:07.849",
        mp3: "../mp3/hsky003.m4a",
        count: 2236
    }, {
        hanyu: "5. 很高兴认识您。",
        hasakeyu: "سىزبەن تانىسقانىما قۋانىشتىمىن.",
        fayin: "思孜本／塔尼斯哈努玛／胡安仕特门。",
        start: "00:07.849",
        end: "00:13.640",
        mp3: "../mp3/hsky003.m4a",
        count: 4635

    }, {
        hanyu: "6. 我在看书。",
        hasakeyu: "مەن كىتاپ وقىپ وتىرمىن.",
        fayin: "芈恩／克塔普／窝合普／窝图尔门。",
        start: "00:13.640",
        end: "00.19.669",
        mp3: "../mp3/hsky003.m4a",
        count: 1236
    }]

    function drawPage(arr) {
        var html = "";
        $(arr).each(function(index, data) {
            html = html.concat("<div class='hsky' mp3='" + data.mp3 + "' stime='" + data.start + "' etime='" + data.end + "'>");

            html = html.concat("<div style='position:relative;'><div style='width:6rem;height:4rem;float:right;font-size:2rem;text-align:center;line-height:4rem;color:#0E6EBC'>" + (index + 1) + "/" + arr.length + "</div></div>");



            html = html.concat("<p style='font-size:1.5rem;margin-top:1rem;'><label style='font-size:1.5rem;color:#0E6EBC;'>【中　　文】</label>" + data.hanyu + "</p>");
            html = html.concat("<p style='font-size:1.5rem'><label style='font-size:1.5rem;color:#0E6EBC;'>【哈萨克语】</label>" + data.hasakeyu + "</p>");
            html = html.concat("<p style='font-size:1.5rem'><label style='font-size:1.5rem;color:#0E6EBC;'>【中文音译】</label>" + data.fayin + "</p>");

            html = html.concat("<p><a class='am-icon-btn am-success am-icon-play'  onclick=\"play('" + data.mp3 + "','" + data.start + "','" + data.end + "',this)\" style='width:3rem;height:3rem;line-height:3rem;font-size:1.5rem;'></a>&nbsp;&nbsp;");
            html = html.concat("<a class='am-icon-btn am-secondary am-icon-repeat' onclick=\"singleLoop('" + data.mp3 + "','" + data.start + "','" + data.end + "',this)\" style='width:3rem;height:3rem;line-height:3rem;font-size:1.5rem;'></a>&nbsp;&nbsp;");
            html = html.concat("<a class='am-icon-btn am-warning am-icon-stop' onclick='pause()' style='width:3rem;height:3rem;line-height:3rem;font-size:1.5rem;'></a>&nbsp;&nbsp;");
            html = html.concat("<a class='am-icon-btn am-danger am-icon-microphone' style='width:3rem;height:3rem;line-height:3rem;font-size:1.5rem;' data-am-modal=\"{target: '#my-alert'}\"></a>&nbsp;&nbsp;");
            var count = data.count;
            html = html.concat("<span id='count' style='font-size:1.2rem;line-height:0.3rem;'>已有<label style='color:orange'>" + count + "</label>人学习 <img  src='../images/icon.png'/ style='max-width:2rem;vertical-align:bottom;'/></span></p>");
            html = html.concat("<div style=\"width:100%;height:3rem;background-image:url('../images/bottom.jpg');background-size:100% 100%\"></div>");
            html = html.concat("</div>");

        });
        html = html.concat("<p>&nbsp;&nbsp;&nbsp;</p>");
        $(".content").html(html);
    }


    drawPage(hsky);
    var audio = $("#audio")[0];
    var timer = null;
    var loopTimer = null;

    /**
     * [singleLoop description]
     * @param  {[type]} src   [description]
     * @param  {[type]} stime [description]
     * @param  {[type]} etime [description]
     * @param  {[type]} dom   [description]
     * @return {[type]}       [description]
     */
    function singleLoop(src, stime, etime, dom) {
        if (loopTimer !== null) {
            clearInterval(loopTimer);
            loopTimer = null;
            audio.pause();
            $(".hsky").removeClass("currentbg");
            audio.src = "";
        }

        pause();
        audio.src = src;
        audio.currentTime = parseFloat(time2time(stime));
        audio.play();

        // console.log($(dom).parent().parent().addClass("currentbg"));
        if (timer === null) {
            timer = setInterval(function() {
                console.log(audio.currentTime + "                      " + time2time(etime));
                if (audio.currentTime >= time2time(etime)) {
                    audio.currentTime = parseFloat(time2time(stime));
                }
            }, 100)
        }
    }

    // 用k为单位表示播放量
    function formatK(count) {
        var _count = 0;
        if (count < 1024) {
            _count = count;
        }
        if (count >= 1024) {
            _count = (count / 1024).toFixed(2) + "<span style='color:orange;'> k</span>";
        }
        return _count;
    }

    function play(src, stime, etime, dom) {
        if (loopTimer !== null) {
            clearInterval(loopTimer);
            loopTimer = null;
            audio.pause();
            $(".hsky").removeClass("currentbg");
            audio.src = "";
        }
        pause();
        audio.src = src;
        audio.currentTime = parseFloat(time2time(stime));
        audio.play();

        // console.log($(dom).parent().parent().addClass("currentbg"));
        if (timer === null) {
            timer = setInterval(function() {


                console.log(audio.currentTime);
                if (audio.currentTime >= time2time(etime)) {
                    clearInterval(timer);
                    timer = null;
                    audio.pause();
                    $(dom).parent().parent().removeClass("currentbg")
                }
            }, 100)
        }
    }

    var mp3Arr = ["../mp3/hsky002.m4a", "../mp3/hsky003.m4a"];
    var number = 0;

    function player() {
        audio.src = mp3Arr[number];
        audio.play();
        findDivByAttr(mp3Arr[number], audio.currentTime);
        if (loopTimer === null) {
            loopTimer = setInterval(function() {
                    findDivByAttr(mp3Arr[number], audio.currentTime);
                    if (audio.ended === true) {
                        number++;
                        if (mp3Arr[number] == undefined) {
                            clearInterval(loopTimer);
                            loopTimer = null;
                            number = 0;
                        } else {
                            audio.src = mp3Arr[number];
                            audio.play();
                        }
                    }
                },
                100
            )
        }
    }


    function findDivByAttr(mp3, currentTime) {
        $("[mp3='" + mp3 + "']").each(function(index, data) {
            var t1 = time2time($(data).attr("stime"));
            var t2 = time2time($(data).attr("etime"));
            // console.log(t1 + "         " + t2 + "           " + currentTime + "         " + data)
            if (t1 <= currentTime && currentTime <= t2) {
                $(data).addClass("currentbg");
            } else {
                $(data).removeClass("currentbg");
            }
            if (t2 === NaN) {
                $(data).removeClass("currentbg");
            }
        });
    }


    $(".start").click(function() {
        if ($(this).attr("class") !== "start am-icon-play") {
            audio.pause();
            $(".hsky").removeClass("currentbg");
            $(this).removeClass("am-icon-stop");
            $(this).removeClass("stop");
            $(this).addClass("start");
            $(this).addClass("am-icon-play");
        } else {
            player();
            $(this).removeClass("am-icon-play");
            $(this).removeClass("start");
            $(this).addClass("am-icon-stop");
            $(this).addClass("stop");
        }



    });


    $(".stop").click(function() {
        audio.pause();
        $(data).removeClass("currentbg");
        $(this).removeClass("am-icon-stop");
        $(this).removeClass("stop");
        $(this).addClass("am-icon-play");
        $(this).addClass("start");

    });

    function pause() {
        var audio = $("#audio")[0];
        audio.pause();
        clearInterval(loopTimer);
        loopTimer = null;
        clearInterval(timer);
        timer = null;
    }

    function time2time(time) {
        var str = time;
        var arr = str.split(':');
        var seconds = parseInt(arr[0] * 60) + parseFloat(arr[1]);
        return seconds;
    }
    </script>
    <br>
    <div id="doc-qrcode" class="am-text-center"></div>
    <p class='am-text-center'>请扫描二维码进行分享</p>
    <hr data-am-widget="divider" style="" class="am-divider am-divider-default" />
    <p class='am-text-center' style='font-size:1.5rem;'>分享到</p>
    <br>
    <p style='text-align:center;'>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://open.weibo.com/" class="am-icon-btn am-danger am-icon-weibo"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <a href="http://open.qq.com/" class="am-icon-btn am-icon-qq am-primary"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <a href="https://open.weixin.qq.com/" class="am-icon-btn am-success am-icon-weixin"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </p>
    <br>
    <hr data-am-widget="divider" style="" class="am-divider am-divider-default" />
    <div data-am-modal="{target: '#my-alert'}" style="width:20rem;height:20rem;border-radius:10rem;background-color:orange;color:#EEEEEE;font-size:4rem;line-height:20rem;margin:0 auto;cursor:pointer;" class='am-text-center'>
        打赏
    </div>
    <p class='am-text-center'>如果你觉的本页内容对你有用请随意打赏</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <script>
    $(function() {
        var $input = $('#doc-qr-text');
        $qr = $('#doc-qrcode');

        function makeCode(text) {
            $qr.empty().qrcode(text);
        }
        $input.val(location.href);
        makeCode(location.href);
    });




    var fullscreen = $.AMUI.fullscreen;

    $('#full').on('click', function() {
        if (fullscreen.enabled) {
            fullscreen.request();
        }
    }).on(fullscreen.raw.fullscreenchange, function() {
        // 监听图片全屏状态
        // var text = '图片状态：' + (fullscreen.isFullscreen ? '全屏' : '非全屏');
        // $('#doc-fs-img').html(text);
    });
    </script>
</body>

</html>
